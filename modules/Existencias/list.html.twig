{# Template list.html.twig for Existencias #}
{# -------------------------------------------------------#}
{% extends 'Existencias/index.html.twig' %}

{% set mostrarUbicaciones = values.listado.data[0].IDAlmacen.ControlUbicaciones.IDTipo %}
{% set unidadMedida = values.listado.filter.flags.unidadMedida %}

{% block listado %}
<div class='Listado'>

    {% include '_global/paginacion.html.twig' with {'filter':values.listado.filter,'controller':'Existencias','position':'izq'}%}

    <table width="100%">
        <tr class='Titulos'>
            <td class='Item'>Articulo</td>
            <td class='Item'>Lote</td>
            {% if mostrarUbicaciones %}
            <td class='Item'>Ubicaci√≥n</td>
            {% endif %}
            <td class='Item'>Disponibles</td>
            <td class='Item'>Reales</td>
            <td class='Item'>Reservadas</td>
            <td class='Item'>Entrando</td>
            <td class='Item'>Dpto</td>
        </tr>

        <tbody class='Cuerpo'>
            {% set almacenAnt = 0 %}
            {% for key,objeto in values.listado.data %}
                {% if (key is even) %}
                    {% set classFila = 'Impar' %}
                {% else %}
                    {% set classFila = 'Par' %}
                {% endif %}

                {% set disponibles = objeto.reales - objeto.reservadas %}
                {% if almacenAnt != objeto.IDAlmacen.IDAlmacen%}
                    <tr><td colspan="9"><div class="InterLinea">{{objeto.IDAlmacen}}</div></td></tr>
                {% endif%}
                {% set almacenAnt = objeto.IDAlmacen.IDAlmacen %}

            <tr class='{{classFila}}' style="font-size: 11px;">
                <td class='Item'>
                    <table style="width: 100%;"><tr><td style="width: 110px;">{{objeto.IDArticulo.Codigo}}</td><td>{{objeto.IDArticulo|slice(0,60)}}</td></tr></table></td>
                <td class='Item'>{{objeto.IDLote}}</td>
                {% if mostrarUbicaciones %}
                <td class='Item'>{{objeto.IDUbicacion}}</td>
                {% endif %}
                <td class="existencias">{{objeto.IDArticulo.convertUnit('UMA',unidadMedida,disponibles)|number_format(2)}}</td>
                <td class="existencias">{{objeto.IDArticulo.convertUnit('UMA',unidadMedida,objeto.Reales)|number_format(2)}}</td>
                <td class="existencias">{{objeto.IDArticulo.convertUnit('UMA',unidadMedida,objeto.Reservadas)|number_format(2)}}</td>
                <td class="existencias">{{objeto.IDArticulo.convertUnit('UMA',unidadMedida,objeto.Entrando)|number_format(2)}}</td>
                <td align='center'>{{objeto.EnDeposito}}</td>
            </tr>
            {% else %}
            <tr><td colspan='7'>No hay informacion que cumpla esos criterios</td></tr>
            {% endfor %}
        </tbody>
    </table>

</div>
{% endblock %}